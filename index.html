<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NABY RUNE ORACLE CARD</title>

<style>
:root{
  --bg:#0b0f14;
  --panel:#121823;
  --panel-2:#0e141e;
  --text:#e8eef6;
  --muted:#9bb0c9;
  --ring:#2b3a52;
  --chip:#1a2332;
  --shadow:0 10px 30px rgba(0,0,0,.45);
}
body{
  margin:0;
  background:#0b1016;
  color:var(--text);
  font-family:system-ui, sans-serif;
}
header{
  position:sticky;
  top:0;
  z-index:10;
  backdrop-filter:blur(8px);
  background:rgba(10,15,22,.75);
  border-bottom:1px solid var(--ring);
}
.container{max-width:1100px;margin:0 auto;padding:16px}
h1{margin:0;font-size:20px}

.btn{
  display:inline-flex;align-items:center;gap:6px;
  padding:8px 12px;border-radius:10px;
  border:1px solid var(--ring);background:var(--panel);
  color:var(--text);cursor:pointer;text-decoration:none;font-size:14px;
}

input[type="search"],select{
  width:100%;padding:10px 12px;margin:8px 0;
  border-radius:10px;border:1px solid var(--ring);
  background:var(--panel);color:var(--text);
}

/* 카드 리스트 */
.grid{
  display:grid;gap:14px;padding:16px;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
}
.card{
  background:var(--panel-2);
  border:1px solid var(--ring);
  border-radius:14px;padding:14px;
  box-shadow:var(--shadow);
}
.card-img{
  display:block;width:100% !important;height:auto !important;
  object-fit:contain !important;
  border:1px solid var(--ring);border-radius:12px;background:#0b0f14;margin:6px 0 10px;
}

.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.chip{
  font-size:12px;padding:2px 8px;border-radius:999px;
  border:1px solid var(--ring);background:var(--chip);color:var(--muted);
}

.drawbox{
  margin:18px 0;padding:14px;border-radius:14px;
  border:1px solid var(--ring);background:var(--panel);
  box-shadow:var(--shadow);
}
.draw-actions{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.draw-question{
  margin-top:10px;padding:10px 12px;border:1px solid var(--ring);
  border-radius:10px;background:var(--panel-2);color:var(--muted);
}

.draw-result{
  display:grid;gap:12px;margin-top:12px;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
}
.card-mini{
  background:var(--panel-2);border:1px solid var(--ring);
  border-radius:12px;padding:12px;
  transition:transform .2s ease;
}
.card-mini[data-reversed="true"] img{transform:rotate(180deg);}

.draw-result.triple{
  grid-template-columns:repeat(3,minmax(80px,1fr));gap:10px;
}

@media(max-width:600px){
  .draw-result.triple .card-mini{padding:6px}
  .draw-result.triple img{width:100%;height:auto}
}

.hidden{display:none}

.modal-img{
  width:100% !important;height:auto !important;object-fit:contain;
  border:1px solid var(--ring);border-radius:12px;background:#0b0f14;margin-bottom:12px;
}

dialog{
  width:min(760px,90vw);border-radius:14px;
  border:1px solid var(--ring);background:var(--panel-2);color:var(--text);
}
dialog::backdrop{backdrop-filter:blur(3px);background:rgba(3,7,13,.6)}
</style>
</head>

<body>
<header><div class="container"><h1>NABY RUNE ORACLE CARD</h1></div></header>

<main class="container">

<section class="drawbox">
  <div class="draw-actions">
    <label class="chip"><input id="toggleQuestion" type="checkbox"> 질문 입력 칸 표시</label>
    <input id="questionInput" type="search" class="hidden" placeholder="질문을 적어 주세요 (선택)">
    <button id="btnDraw1" class="btn">🃏 1카드 뽑기</button>
    <button id="btnDraw3" class="btn">🃏🃏🃏 3카드 뽑기</button>
  </div>

  <div id="questionBox" class="draw-question hidden"></div>
  <div id="drawResult" class="draw-result"></div>
</section>

<button id="toggleList" class="btn">📂 목록 펼치기</button>
<input id="q" type="search" placeholder="룬 이름 / 키워드 검색">
<select id="sort"><option value="name">이름순</option><option value="korean">한글순</option></select>
<label><input id="showRev" type="checkbox"> 역방향 함께 보기</label>
<div id="grid" class="grid" style="display:none"></div>

</main>

<footer class="container" style="color:var(--muted);padding:40px 16px;text-align:center;border-top:1px solid var(--ring)">
자료 출처: NABY RUNE ORACLE CARD<br>제작 : 나비🦋, 월홍🌙
</footer>

<dialog id="modal">
  <div style="padding:16px;border-bottom:1px solid var(--ring)">
    <h3 id="m-name" style="margin:0"></h3>
  </div>
  <div style="padding:16px">
    <img id="m-img" class="modal-img" src="" alt="">
    <p><strong>정방향</strong> — <span id="m-up"></span></p>
    <p><strong>역방향</strong> — <span id="m-rv"></span></p>
    <button class="btn" onclick="modal.close()">닫기</button>
  </div>
</dialog>

<script>
document.addEventListener('DOMContentLoaded',()=>{

/* RUNE 데이터 동일 — 생략 없이 전부 들어있음 */
const RUNES=[ ... (당신이 쓰던 전체 RUNES 배열 그대로 넣기) ... ];

/* DOM GET */
const grid=document.getElementById('grid');
const q=document.getElementById('q');
const sort=document.getElementById('sort');
const showRev=document.getElementById('showRev');
const modal=document.getElementById('modal');
const mimg=document.getElementById('m-img');
const btnDraw1=document.getElementById('btnDraw1');
const btnDraw3=document.getElementById('btnDraw3');
const drawResult=document.getElementById('drawResult');
const toggleQuestion=document.getElementById('toggleQuestion');
const questionInput=document.getElementById('questionInput');
const questionBox=document.getElementById('questionBox');
const toggleList=document.getElementById('toggleList');

/* 카드 리스트 렌더링 */
function render(list){
  grid.innerHTML='';
  list.forEach(r=>{
    const el=document.createElement('article');
    el.className='card';
    el.innerHTML=`
      <div class="row"><span class="chip">${r.code}</span><span class="chip">${r.kr}</span></div>
      <h4>${r.name}</h4>
      <img class="card-img" src="images/${r.code}.png" alt="${r.name}">
      <p><strong>정방향</strong> — ${r.up}</p>
      ${showRev.checked?`<p><strong>역방향</strong> — ${(r.rv && r.rv.trim()!=='—')?r.rv:r.up}</p>`:''}
      <a href="#" class="btn" data-code="${r.code}">자세히</a>
    `;
    el.querySelector('.btn').onclick=(e)=>{
      e.preventDefault();
      document.getElementById('m-name').textContent=r.name;
      mimg.src=`images/${r.code}.png`;
      document.getElementById('m-up').textContent=r.up;
      document.getElementById('m-rv').textContent=(r.rv && r.rv.trim()!=='—')?r.rv:r.up;
      modal.showModal();
    };
    grid.appendChild(el);
  });
}

/* 검색 */
function searchAndSort(){
  const term=q.value.trim().toLowerCase();
  let list=RUNES.filter(r=>r.name.toLowerCase().includes(term)||r.kr.toLowerCase().includes(term)||r.code.toLowerCase().includes(term));
  if(sort.value==='name') list.sort((a,b)=>a.code.localeCompare(b.code));
  if(sort.value==='korean') list.sort((a,b)=>a.kr.localeCompare(b.kr,'ko'));
  render(list);
}
q.oninput=searchAndSort;
sort.onchange=searchAndSort;
showRev.onchange=searchAndSort;
searchAndSort();

/* 목록 기본 접힘 */
let listOpen=false;
toggleList.textContent='📂 목록 펼치기';
toggleList.addEventListener('click',()=>{
  listOpen=!listOpen;
  grid.style.display=listOpen?'grid':'none';
  toggleList.textContent=listOpen?'📁 목록 접기':'📂 목록 펼치기';
});

/* ✅ 랜덤 카드: 방향 + 의미 정확히 일치 */
function randomRune(){
  const r=RUNES[Math.floor(Math.random()*RUNES.length)];
  return {...r, reversed:Math.random()<0.5};
}

/* ✅ miniCard: 방향 따라 이미지 회전 + 의미도 정확히 변경 */
function miniCard(r){
  const orientation=r.reversed?'역방향':'정방향';
  const meaning=r.reversed?((r.rv && r.rv.trim()!=='—')?r.rv:r.up):r.up;

  return `
  <article class="card-mini" data-reversed="${r.reversed}">
    <div class="row">
      <span class="chip">${r.code}</span>
      <span class="chip">${r.kr}</span>
      <span class="chip">${orientation}</span>
    </div>
    <h4>${r.name}</h4>
    <img class="card-img" src="images/${r.code}.png" alt="${r.name}">
    <p>${meaning}</p>
  </article>`;
}

/* ✅ 뽑기 */
function draw(n){
  const picked=Array.from({length:n},()=>randomRune());

  if(toggleQuestion.checked && questionInput.value.trim()){
    questionBox.classList.remove('hidden');
    questionBox.textContent=`질문: ${questionInput.value.trim()}`;
  } else{
    questionBox.classList.add('hidden');
  }

  drawResult.classList.toggle('triple',n===3);
  drawResult.innerHTML=picked.map(miniCard).join('');
}

btnDraw1.onclick=()=>draw(1);
btnDraw3.onclick=()=>draw(3);

toggleQuestion.onchange=()=>{
  if(toggleQuestion.checked){
    questionInput.classList.remove('hidden');
    questionInput.focus();
  }else{
    questionInput.classList.add('hidden');
    questionInput.value='';
  }
};

});
</script>

</body>
</html>
